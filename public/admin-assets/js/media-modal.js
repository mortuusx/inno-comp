"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),mediaModals=document.querySelectorAll("[media-modal]"),e=function(e){return document.createElement(e)};HTMLElement.prototype.a=function(e){var t=this;return e.text&&this.appendChild(document.createTextNode(e.text)),e.nodes&&e.nodes.forEach(function(e){return t.appendChild(e)}),Object.keys(e).forEach(function(i){e[i]&&"text"!==i&&"nodes"!==i&&t.setAttribute(i,e[i])}),this};var MediaModal=function(){function t(e){_classCallCheck(this,t),this.name="media-modal",this.openAttribute=this.name+"-open",this.element=e,this.modalElement=document.getElementById(this.name),this.createFields(),this.modalElement||this.createModalElement(),this.update()}return _createClass(t,[{key:"id",get:function(){return this.element.getAttribute("media-modal-id")}},{key:"open",get:function(){return document.body.hasAttribute(this.openAttribute)},set:function(e){e?document.body.setAttribute(this.openAttribute,""):document.body.removeAttribute(this.openAttribute)}},{key:"images",get:function(){return this.element.getAttribute("images")?JSON.parse(this.element.getAttribute("images")):[]},set:function(e){this.element.setAttribute("images",JSON.stringify(e))}},{key:"cover",get:function(){return this.element.getAttribute("cover")?JSON.parse(this.element.getAttribute("cover")):{}}}]),_createClass(t,[{key:"cName",value:function(e){return this.name+"__"+e}},{key:"createFields",value:function(){var t=this,i=e("legend").a({id:this.cName("legend"),class:this.cName("legend"),text:"Képek"}),n=e("input").a({type:"hidden",id:this.cName("images"),class:this.cName("images"),name:"images",value:JSON.stringify(this.images.map(function(e){return e._id}))}),a=e("div").a({id:this.cName("image-holder"),class:this.cName("image-holder")}),s=e("button").a({type:"button",text:"Képek kiválasztása",class:this.cName("button choose-button mdl-button mdl-js-button mdl-button--raised mdl-button--colored")});s.addEventListener("click",function(){t.refreshList().then(function(){t.open=!0})}),[i,n,a,s].forEach(function(e){return t.element.appendChild(e)})}},{key:"createModalElement",value:function(){var t=this,i=e("div").a({class:this.cName("layer")}),n=e("div").a({id:this.name,class:this.cName("container")}),a=e("h2").a({text:"Képek kiválasztása",class:this.cName("title")}),s=e("button").a({type:"button",class:this.cName("button close-button"),nodes:[e("i").a({class:"material-icons",text:"clear"})]}),o=e("ul").a({id:this.cName("image-list"),class:this.cName("image-list")}),r=e("button").a({type:"button",class:this.cName("button add-button mdl-button mdl-js-button mdl-button--raised mdl-button--colored"),text:"Hozzáadás"});s.addEventListener("click",function(){t.open=!1}),r.addEventListener("click",function(){t.update(),t.open=!1}),[a,s,o,r].forEach(function(e){return n.appendChild(e)}),i.appendChild(n),document.body.appendChild(i)}},{key:"refreshList",value:function(){var t=this;return new Promise(function(i,n){var a=document.getElementById(t.cName("image-list")),s=new XMLHttpRequest;a.innerHTML="",s.addEventListener("readystatechange",function(){4===s.readyState&&200===s.status&&(JSON.parse(s.responseText).forEach(function(i){var n=e("li").a({class:t.cName("image-list__item")}),s=e("button").a({class:t.cName("image-list__item__button"),style:"background:url("+i.filename+") no-repeat center / cover","media-id":i._id,"media-filename":i.filename});-1<t.images.map(function(e){return e._id}).indexOf(i._id)&&s.setAttribute("selected",""),s.addEventListener("click",function(){var e=t.images,i=e.map(function(e){return e._id}).indexOf(s.getAttribute("media-id"));-1<i?(e=e.slice(0,i).concat(e.slice(i+1,e.length)),s.removeAttribute("selected")):(e=e.concat([{_id:s.getAttribute("media-id"),filename:s.getAttribute("media-filename")}]),s.setAttribute("selected","")),t.images=e}),n.appendChild(s),a.appendChild(n)}),i())}),s.open("GET",window.location.origin+"/mediaList/",!0),s.send()})}},{key:"update",value:function(){var t=document.getElementById(this.cName("images")),i=document.getElementById(this.cName("image-holder")),n=this.cover._id;t.value="",i.innerHTML="",t.value=JSON.stringify(this.images.map(function(e){return e._id})),this.images.forEach(function(t){i.appendChild(e("div").a({class:"image",nodes:[e("img").a({src:t.filename,alt:""}),e("label").a({text:"Borító",class:"image__label",nodes:[e("input").a({type:"radio",name:"cover",value:t._id,checked:n===t._id?"checked":null})]})]}))})}}]),t}();Array.from(mediaModals).map(function(e){return e.setAttribute("media-modal-id","media-modal-"+Math.floor(1e5*Math.random())),new MediaModal(e)});